<!DOCTYPE html>
<html>
  <head>
    <title>Hacker News Live Feed</title>
    <style>
      .story {
        padding: 15px;
        margin: 10px 0;
        border: 1px solid #eee;
        border-radius: 5px;
      }
      .stats {
        padding: 10px;
        background: #f5f5f5;
        margin-bottom: 20px;
      }
      .title {
        color: #333;
        text-decoration: none;
        font-weight: bold;
      }
      .meta {
        color: #666;
        font-size: 0.9em;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="stats" id="stats">Connecting...</div>
    <div id="stories"></div>

    <script>
      const ws = new WebSocket(
        `ws://${window.location.hostname}:${window.location.port}`
      );
      const storiesDiv = document.getElementById("stories");
      const statsDiv = document.getElementById("stats");

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "stats") {
          statsDiv.textContent = `Stories in last 5 minutes: ${data.storiesLast5Min}`;
        } else if (data.type === "newStory") {
          const storyDiv = document.createElement("div");
          storyDiv.className = "story";
          storyDiv.innerHTML = `
                    <a href="${data.story.url}" class="title" target="_blank">
                        ${data.story.title}
                    </a>
                    <div class="meta">
                        by ${data.story.author} | ${data.story.points} points | 
                        ${data.story.comments} comments
                    </div>
                `;
          storiesDiv.insertBefore(storyDiv, storiesDiv.firstChild);
        }
      };

      ws.onopen = () => {
        statsDiv.textContent = "Connected! Waiting for updates...";
      };

      ws.onclose = () => {
        statsDiv.textContent = "Disconnected. Refresh to reconnect.";
      };
    </script>
  </body>
</html>
